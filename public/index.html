<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø³Ø§Ù†Ø¯ - Ù†Ø¸Ø§Ù… ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      /* Ù„ÙˆØ­Ø© TVTC ØªÙ‚Ø±ÙŠØ¨ÙŠØ© */
      --tvtc-blue:#1e3c72;   /* Ø£Ø²Ø±Ù‚ Ø±Ø¦ÙŠØ³ÙŠ */
      --tvtc-teal:#00a49a;   /* Ø£Ø®Ø¶Ø± Ù…ÙØ²Ø±Ù‚ */
      --tvtc-navy:#0b1f3a;   /* Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† */

      --bg-grad:linear-gradient(135deg,var(--tvtc-blue) 0%,var(--tvtc-teal) 100%);
      --header-grad:linear-gradient(135deg,var(--tvtc-navy) 0%,var(--tvtc-blue) 100%);

      --card-bg:#fff;
      --text:#1f2937;
      --muted:#495057;
      --border:#e9ecef;

      /* Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø­Ø§Ù„Ø© */
      --chip-ok-bg:#d4edda;  --chip-ok-text:#155724;
      --chip-warn-bg:#fff3cd;--chip-warn-text:#856404;
      --chip-bad-bg:#f8d7da; --chip-bad-text:#721c24;

      /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ù„Ø¨ */
      --req-warn-bg:#fff8e1; --req-warn-bd:#ffcc02;
      --req-acc-bg:#e8f5e8;  --req-acc-bd:#4caf50;
      --req-rej-bg:#ffebee;  --req-rej-bd:#f44336;
    }

        :root{
      --base-fs: 20px; /* Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ */
    }

    /* Ø®Ù„Ù‘ÙŠ Ø§Ù„Ù€ rem ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØºÙŠØ± */
    html{ font-size: var(--base-fs); }

    /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
    .dark{
      --bg-grad:linear-gradient(135deg,#0f172a 0%,#0b1f3a 100%);
      --card-bg:#111827;
      --text:#e5e7eb;
      --muted:#cbd5e1;
      --border:#374151;
      --header-grad:linear-gradient(135deg,#0b1f3a 0%,#1e3c72 100%);

      --chip-ok-bg:#064e3b; --chip-ok-text:#a7f3d0;
      --chip-warn-bg:#92400e; --chip-warn-text:#fde68a;
      --chip-bad-bg:#7f1d1d; --chip-bad-text:#fecaca;

      --req-warn-bg:#2a2610; --req-warn-bd:#b69100;
      --req-acc-bg:#11331a;  --req-acc-bd:#3aa85e;
      --req-rej-bg:#3a1618;  --req-rej-bd:#cc3535;
    }
    /* Ø®Ø· Ø£Ø³Ø§Ø³ÙŠ + Ø¨Ø¯Ø§Ø¦Ù„ Ø¹Ø±Ø¨ÙŠØ© Ø¢Ù…Ù†Ø© */
    body{
      font-family: 'Sakkal Majalla','Noto Naskh Arabic','Cairo','Tajawal','Segoe UI','Tahoma',sans-serif;
      background:var(--bg-grad);
      min-height:100vh;
      color:var(--text);
      padding:20px;
      padding-bottom:200px;  /* âœ… Ø²ÙŠØ§Ø¯Ø© ÙƒØ¨ÙŠØ±Ø© */
    }

    /* ØªØ­Ø³ÙŠÙ† ÙˆØ¶ÙˆØ­ Ø§Ù„Ø­Ø±ÙˆÙ */
    html,body{
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }


    
      /* Card Ù…ÙˆØ­Ø¯ Ù„Ù„Ø®Ø·ÙˆØ§Øª */
      .card {
        background: var(--card-bg);
        border: 1px solid rgba(0,0,0,.06);
        border-radius: 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,.06);
        padding: 18px;
      }

      /* Ø²Ø± Primary Ùˆ Outline (Ù†ÙØ³ Ø§Ù„Ø£Ù„ÙˆØ§Ù†) */
      .btn-primary {
        background: linear-gradient(135deg, var(--tvtc-blue), var(--tvtc-teal));
      }
      .btn-outline {
        background: transparent;
        color: var(--tvtc-blue);
        border: 2px solid var(--tvtc-blue);
      }
      .dark .btn-outline {
        color: #e5e7eb;
        border-color: #e5e7eb33;
      }

      /* ØªØ±ÙƒÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ */
      .form-control:focus {
        outline: none;
        border-color: var(--tvtc-blue);
        box-shadow: 0 0 0 3px rgba(30, 60, 114, .15);
      }

      /* Ø´Ø§Ø±Ø© Ø§Ù„Ù‚Ø³Ù… (Pill) Ø£Ø®Ù */
      .section-pill {
        display:inline-block;
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--card-bg);
        font-weight: 700;
      }
    /* Ø­Ø§ÙˆÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ© */
    .container{
      max-width:1040px;
      margin:0 auto 180px auto;  /* âœ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© */
      border-radius:15px;
      box-shadow:0 20px 40px rgba(0,0,0,.1);
      overflow:hidden;
      background:var(--card-bg);
    }
    /* Ù‡ÙŠØ¯Ø± */
    .header{
      background:var(--header-grad);
      color:#fff;
      padding:18px 10px;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø±: Ø£Ø¹Ø·Ù Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø±Ø¶Ù‹Ø§ ÙƒØ§ÙÙŠÙ‹Ø§ */
    .header-bar{
      display:grid;
      grid-template-columns: 1fr auto 1fr;  /* Ø¹Ù…ÙˆØ¯ Ø£ÙŠØ³Ø± ÙØ§Ø±ØºØŒ Ø¹Ù…ÙˆØ¯ ÙˆØ³Ø· Ù„Ù„Ø´Ø¹Ø§Ø±ØŒ Ø¹Ù…ÙˆØ¯ Ø£ÙŠÙ…Ù† Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
      align-items:center;
      gap:12px;
      position: relative;
    }




    .user-name{font-weight:700}
    .role-badge{
      background:#0ea5e9;
      color:#fff;
      padding:4px 10px;
      border-radius:999px;
      font-size:.85rem;
    }

    .user-actions{display:flex;align-items:center;grid-column: 3;justify-self:end}
    .logout-btn{
      background:#ef4444;
      color:#fff;border:none;border-radius:8px;
      padding:8px 14px;font-weight:700;cursor:pointer;transition:.2s
    }
    .logout-btn:hover{background:#dc2626}


    /* Ø´Ø¹Ø§Ø± Ù…ÙƒØ¯Ù‘Ø³ Ø¹Ù…ÙˆØ¯ÙŠÙ‹Ø§ */
    /* 2) Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
      /* Ø¶Ø¹ Ø§Ù„ÙƒØªÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆØ³Ø· ÙˆÙˆØ³Ù‘Ø· Ø§Ù„Ù†Øµ */
      .brand-inline{
        grid-column: 2;        /* Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆØ³Ø· */
        justify-self: center;
        text-align: center;
      }
      
      .brand-inline .brand-logo-tall{
        position: static !important;   /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù€ absolute */
        height: 64px;                  /* Ø£Ùˆ 72px Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ */
        width: auto;
        transform: none !important;
        right: auto !important;
        left: auto !important;
        top: auto !important;
        margin: 0 auto;                /* ØªÙˆØ³ÙŠØ· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆØ³Ø· */
      }
    .brand-stack{display:flex;flex-direction:column;align-items:center;gap:8px;min-width:0}
    .brand-logo-tall{height:72px;width:auto;display:block;margin:0 auto;filter:drop-shadow(0 2px 4px rgba(0,0,0,.15))}
    .brand-text .logo{font-size:1.6rem;line-height:1.1;font-weight:800;white-space:nowrap}
    .brand-text .tagline{font-size:.95rem;opacity:.9;line-height:1.1}

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    .stats-bar{display:flex;justify-content:center;gap:28px;margin-top:10px}
    .stat-item{text-align:center}
    .stat-number{font-size:1.2rem;font-weight:700}
    .stat-label{font-size:.85rem;opacity:.95}

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .login-section{padding:35px;background:linear-gradient(135deg,#f8f9fa 0%,#ffffff 100%);border-bottom:1px solid #e9ecef}
    .login-container{max-width:520px;margin:0 auto;text-align:center}
    .welcome-message{font-size:1.15rem;color:#2c5aa0;margin-bottom:18px;font-weight:700}
    .login-form{display:none;animation:fade .45s}
    .login-form.active{display:block}

    /* ØªØ¨ÙˆÙŠØ¨Ø§Øª */
    .tabs{display:none;background:#f8f9fa;border-bottom:1px solid #dee2e6}
    .tabs.active{display:flex;flex-wrap:wrap}
    .tab{flex:1;padding:14px 10px;text-align:center;cursor:pointer;transition:.2s;background:#fff;border:0;font-size:1.02rem;font-weight:700;color:#495057;position:relative}
    .tab:hover{background:#e9ecef}
    .tab.active{background:#2c5aa0;color:#fff}
    .tab.badged .badge{
      position:absolute;top:6px;inset-inline-end:10px;background:#ef4444;color:#fff;min-width:20px;height:20px;
      padding:0 6px;border-radius:999px;font-size:.8rem;display:flex;align-items:center;justify-content:center;font-weight:800
    }

    /* Ù…Ø­ØªÙˆÙ‰ */
    .content{padding:22px;min-height:440px;display:none}
    .content.active{display:block}
    @keyframes fade{from{opacity:.3;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* Ù†Ù…Ø§Ø°Ø¬ */
    .form-group{margin-bottom:16px}
    .form-group label{color:var(--muted)}
    .form-control{width:100%;padding:12px;border:2px solid var(--border);border-radius:8px;font-size:1rem;transition:.2s;background:var(--card-bg);color:var(--text)}
    .form-control:focus{outline:none;border-color:#2c5aa0;box-shadow:0 0 0 3px rgba(44,90,160,.12)}
    .field-hint{font-size:.85rem;margin-top:6px}
    .field-hint.neutral{color:#6b7280}
    .field-hint.good{color:#16a34a}
    .field-hint.warn{color:#b45309}

    .btn{background:linear-gradient(135deg,#1cb26b 0%,#11a39b 100%);color:#fff;padding:12px 20px;border:none;border-radius:8px;font-weight:800;cursor:pointer;transition:.2s;text-decoration:none;display:inline-block}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 16px rgba(0,0,0,.15)}
    .btn:disabled{background:#6c757d;cursor:not-allowed;transform:none;opacity:.6}
    .btn-primary{background:linear-gradient(135deg,var(--tvtc-blue) 0%,var(--tvtc-teal) 100%)}
    .btn-secondary{background:linear-gradient(135deg,#6c757d 0%,#495057 100%);color:#fff}
    .btn-whatsapp{background:linear-gradient(135deg,#25d366 0%,#128c7e 100%);margin-inline:6px;padding:10px 16px;font-size:.92rem}
    .btn-accept{background:linear-gradient(135deg,#4caf50 0%,#45a049 100%)}
    .btn-reject{background:linear-gradient(135deg,#f44336 0%,#d32f2f 100%)}
    .btn-contact{background:linear-gradient(135deg,#2196f3 0%,#1976d2 100%)}

    .dashboard-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin:16px 0}
    .stat-card{background:linear-gradient(135deg,var(--tvtc-blue) 0%,var(--tvtc-teal) 100%);color:#fff;padding:16px;border-radius:12px;text-align:center}
    .stat-card .stat-number{font-size:1.7rem;margin-bottom:6px}

    .driver-card,.request-card{background:linear-gradient(135deg,rgba(248,249,250,.25) 0%,var(--card-bg) 100%);border:2px solid var(--border);border-radius:12px;padding:18px;margin-bottom:14px;transition:.2s}
    .driver-card:hover,.request-card:hover{border-color:#2c5aa0;transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,.08)}

    .request-card{border-color:var(--req-warn-bd);background:linear-gradient(135deg,var(--req-warn-bg) 0%,var(--card-bg) 100%)}
    .request-card.accepted{border-color:var(--req-acc-bd);background:linear-gradient(135deg,var(--req-acc-bg) 0%,var(--card-bg) 100%)}
    .request-card.rejected{border-color:var(--req-rej-bd);background:linear-gradient(135deg,var(--req-rej-bg) 0%,var(--card-bg) 100%)}

    .driver-info,.request-header{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:center;margin-bottom:10px}
    .driver-details h3,.request-title{color:#2c5aa0;margin-bottom:6px;font-size:1.06rem}
    .driver-details p,.request-details p{margin-bottom:4px;color:#555}
    .rating{color:#ffc107}

    .status-available,.status-accepted{background:var(--chip-ok-bg);color:var(--chip-ok-text);padding:4px 10px;border-radius:999px;font-weight:700}
    .status-booked,.status-rejected{background:var(--chip-bad-bg);color:var(--chip-bad-text);padding:4px 10px;border-radius:999px;font-weight:700}
    .status-pending{background:var(--chip-warn-bg);color:var(--chip-warn-text);padding:4px 10px;border-radius:999px;font-weight:700}

    .alert{padding:12px;border-radius:8px;margin-bottom:14px}
    .alert-success{background:#d4edda;border:1px solid #c3e6cb;color:#155724}
    .alert-info{background:#cce7ff;border:1px solid #99d6ff;color:#0c5460}
    .alert-warning{background:#fff3cd;border:1px solid #ffeaa7;color:#856404}
    .alert-error{background:#f8d7da;border:1px solid #f5c2c7;color:#721c24}

    .loading{text-align:center;padding:16px}
    .spinner{border:4px solid #f3f3f3;border-top:4px solid #2c5aa0;border-radius:50%;width:34px;height:34px;animation:spin 1s linear infinite;margin:0 auto}
    @keyframes spin{to{transform:rotate(360deg)}}

    .checkbox-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:6px}
    .checkbox-item{display:flex;align-items:center;gap:8px}

    /* Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
    .connbar{display:flex;align-items:center;gap:10px;justify-content:center;background:#0b132b;color:#fff;padding:10px;margin-top:10px;border-radius:12px}
    .conn-dot{width:10px;height:10px;border-radius:50%}
    .conn-online{background:#22c55e}
    .conn-connecting{background:#f59e0b}
    .conn-offline{background:#ef4444}
    .conn-text{font-weight:700}

    /* Ø´Ø§Ø´Ø© ØªØ¹Ø±ÙŠÙ ØªØºØ·ÙŠ Ø§Ù„ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø© */
    .intro-screen{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background:var(--bg-grad);padding:24px;overflow:auto}
    .intro-content{width:min(92vw,860px);max-height:92vh;overflow:auto;background:#ffffffd1;backdrop-filter:blur(6px);border-radius:18px;box-shadow:0 20px 40px rgba(0,0,0,.12);padding:24px;text-align:center}
    .intro-hero{display:block;max-width:100%;height:auto;border-radius:14px;margin:0 auto 14px}
    .intro-start{padding:12px 22px;border:0;border-radius:999px;font-weight:700;cursor:pointer;background:#0f172a;color:#fff;box-shadow:0 8px 18px rgba(0,0,0,.18);margin:10px 6px}
    .intro-start:active{transform:scale(.98)}
    .intro-loader{display:none;font-weight:700;margin-top:8px}
    .intro-loader.show{display:block}
    html:not(.app-ready) .container,
    html:not(.app-ready) .connbar,
    html:not(.app-ready) .site-footer{display:none!important}
    html:not(.app-ready),html:not(.app-ready) body{height:100%;overflow:hidden}
    html.app-ready #intro-screen{display:none!important}

    /* Ø²Ø± Ø¯Ø¹Ù… Ø¹Ø§Ø¦Ù… */
    .support-fab{position:fixed;inset-inline-end:18px;bottom:84px;z-index:9998}
    .support-fab button.main{width:52px;height:52px;border:0;border-radius:999px;cursor:pointer;background:linear-gradient(135deg,#1e3c72 0%,#00a49a 100%);color:#fff;font-size:22px;box-shadow:0 12px 28px rgba(0,0,0,.18)}
    .support-menu{position:absolute;inset-inline-end:0;bottom:62px;display:none;gap:8px;flex-direction:column;align-items:flex-end}
    .support-menu a{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:#fff;background:#111827;border-radius:999px;padding:10px 12px;font-weight:800;box-shadow:0 10px 20px rgba(0,0,0,.15)}
    .support-menu a .ico{width:26px;height:26px;display:grid;place-items:center;border-radius:999px;background:rgba(255,255,255,.12)}
    .support-menu a.wa{background:#128c7e}
    .support-menu a.mail{background:#0b5ed7}
    .support-fab.open .support-menu{display:flex}
    .support-tip.show{opacity:1;transform:translateY(0)}
      /* ØªÙ„Ù…ÙŠØ­ ØªØ±Ø­ÙŠØ¨ÙŠ Ù…Ø­Ø³Ù‘Ù† */
      .welcome-support-tooltip{
        position: fixed;
        inset-inline-end: 82px;
        bottom: 94px;
        z-index: 9999;
        background: linear-gradient(135deg, #1e3c72 0%, #00a49a 100%);
        color: #fff;
        padding: 0;
        border-radius: 16px;
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25);
        opacity: 0;
        transform: translateX(20px) scale(0.9);
        pointer-events: none;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        max-width: 260px;
        animation: tooltipPulse 2s ease-in-out infinite;
      }

      .welcome-support-tooltip.show{
        opacity: 1;
        transform: translateX(0) scale(1);
        pointer-events: auto;
      }

      @keyframes tooltipPulse{
        0%, 100%{ box-shadow: 0 12px 32px rgba(0, 0, 0, 0.25); }
        50%{ box-shadow: 0 12px 38px rgba(30, 60, 114, 0.4); }
      }

      .tooltip-arrow{
        position: absolute;
        inset-inline-start: 100%;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-inline-start: 10px solid #00a49a;
      }

      .tooltip-content{
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
      }

      .tooltip-icon{
        font-size: 2rem;
        line-height: 1;
        animation: tooltipWave 1.5s ease-in-out infinite;
      }

      @keyframes tooltipWave{
        0%, 100%{ transform: rotate(0deg); }
        25%{ transform: rotate(-15deg); }
        75%{ transform: rotate(15deg); }
      }

      .tooltip-text{
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .tooltip-text strong{
        font-size: 0.95rem;
        font-weight: 800;
        line-height: 1.2;
      }

      .tooltip-text span{
        font-size: 0.8rem;
        opacity: 0.9;
        line-height: 1.2;
      }

      /* Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø®ÙÙŠ Ù„Ù„ØªÙ„Ù…ÙŠØ­ */
      .welcome-support-tooltip::after{
        content: 'Ã—';
        position: absolute;
        top: 4px;
        inset-inline-end: 8px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.2s;
        line-height: 1;
      }

      .welcome-support-tooltip:hover::after{
        opacity: 1;
      }

      /* Ù„Ù„Ø¬ÙˆØ§Ù„ */
      @media (max-width: 768px){
        .welcome-support-tooltip{
          inset-inline-end: 72px;
          bottom: 154px;
          max-width: 220px;
        }
        
        .tooltip-content{
          padding: 10px 12px;
          gap: 10px;
        }
        
        .tooltip-icon{
          font-size: 1.6rem;
        }
        
        .tooltip-text strong{
          font-size: 0.85rem;
        }
        
        .tooltip-text span{
          font-size: 0.75rem;
        }
      }

      /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© */
      html:not(.app-ready) .welcome-support-tooltip{
        display: none !important;
      }
    /* ÙÙˆØªØ± Ø«Ø§Ø¨Øª */
    .site-footer{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(11, 31, 58, 0.98));
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 9999;
      padding: 8px 16px;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
    }

    .footer-content{
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      max-width: 1040px;
      margin: 0 auto;
    }

    .footer-logo{
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-icon{
      font-size: 2rem;
      line-height: 1;
    }

    .footer-text{
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .footer-text strong{
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }


    .footer-text span{
      font-size: 0.75rem;  /* ØªØµØºÙŠØ± Ø§Ù„Ø®Ø· */
      color: #fff;
      font-weight: 700;
      line-height: 1.3;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø·Ø± */
      font-family: 'Cairo', 'Tajawal', sans-serif;
    }

    .footer-institute{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .institute-badge{
      background: linear-gradient(135deg, var(--tvtc-blue), var(--tvtc-teal));
      color: #fff;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 800;
      box-shadow: 0 2px 8px rgba(30, 60, 114, 0.3);
    }

    .version{
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
      font-weight: 600;
    }

    @media (max-width: 768px){
      .site-footer{ padding: 6px 10px; }  /* Ù…Ø³Ø§ÙØ© Ø£ØµØºØ± */
      
      .footer-content{
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }
      
      .footer-logo{
        flex-direction: column;
        gap: 8px;
      }
      
      .footer-text{
        align-items: center;
      }
      
      .footer-text strong{
        font-size: 0.65rem;
      }
      
      .footer-text span{
        font-size: 0.7rem;  /* Ø£ØµØºØ± Ù„Ù„Ø¬ÙˆØ§Ù„ */
        line-height: 1.2;
      }
      
      .footer-institute{
        align-items: center;
      }
      
      .institute-badge{
        font-size: 0.75rem;
        padding: 5px 12px;
      }
    }
    /* Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ */
    .welcome-banner{
      background: linear-gradient(135deg, #1e3c72, #00a49a);
      color: #fff;
      padding: 12px 20px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 16px;
      animation: slideDown 0.5s ease-out;
      font-weight: 700;
    }
    @keyframes slideDown{
      from{ opacity: 0; transform: translateY(-20px); }
      to{ opacity: 1; transform: translateY(0); }
    }
    /* Ø£Ø¯ÙˆØ§Øª */
    .hidden{display:none!important}

    /* Ø³Ù…Ø§ÙƒØ§Øª Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ­ÙƒÙ‘Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù…Ù„ */
    .w-thin    { font-weight: 300; }  /* Ø±ÙÙŠØ¹ (Ø¹Ù†Ø§ÙˆÙŠÙ† ÙØ±Ø¹ÙŠØ©/Ù†Øµ Ø«Ø§Ù†ÙˆÙŠ) */
    .w-regular { font-weight: 400; }  /* Ø¹Ø§Ø¯ÙŠ */
    .w-bold    { font-weight: 700; }  /* Ø¹Ø±ÙŠØ¶ (Ù…Ù‡Ù…) */

    /* ØªØ£ÙƒÙŠØ¯ ÙˆØ¶ÙˆØ­ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø© */
    .em-high   { font-weight: 700; font-size: 1.05em; letter-spacing: .1px; }
    .em-med    { font-weight: 600; }
    .em-low    { font-weight: 400; opacity: .92; }


    /* ===== ØªÙƒØ¨ÙŠØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙ‚Ø· ===== */
    #homeContent { 
      font-size: 1.25rem;          /* ÙŠÙƒØ¨Ù‘Ø± ÙƒÙ„ Ù†ØµÙˆØµ Ø§Ù„Ù‚Ø³Ù… */
      line-height: 1.8;
    }
    #homeContent .section-lead { margin-bottom: 12px; }

    /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
    #homeContent h2{
      font-size: clamp(1.9rem, 3vw, 2.4rem);
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    #homeContent .stat-card .stat-number{
      font-size: clamp(2rem, 3vw, 2.4rem);
    }
    #homeContent .stat-card .stat-label{
      font-size: 1.05rem;
    }

        /* ÙØ§ØµÙ„ Ø±ÙÙŠØ¹ ØªØ­Øª Ø§Ù„Ø´Ø¹Ø§Ø± */
    .header-split{
      height: 1px;
      background: rgba(255,255,255,.25);
      margin: 10px 0 12px;
    }


    /* Ø²Ø± Ù…Ø­Ø§ÙŠØ¯ ØµØºÙŠØ± Ù„Ù„Ø£ÙƒØ´Ù†Ø§Øª (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†) */
    .pill-btn{
      background:#111827;
      color:#fff;
      border:none;
      border-radius:8px;
      padding:8px 14px;
      font-weight:700;
      cursor:pointer;
      transition:.2s;
    }
    .pill-btn:hover{ opacity:.9 }


    /* (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ØµØºÙ‘Ø± Ø§Ù„Ø´Ø§Ø±Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    .header-sub .role-badge{ flex: none; }
      

            /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ø§Ù„ÙˆØ³Ø· */
      .header .stats-bar{
        justify-content: center;
      }

      /* Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØ³ÙŠØ· */
      .mode-login .header .stats-bar{
        justify-content: center;
      }


            /* Divider ÙˆØ³Ø·ÙŠ Ø¨Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
      .section-divider{
        position: relative;
        text-align: center;
        margin: 18px 0 8px;
      }
      .section-divider span{
        display:inline-block;
        background: var(--card-bg);
        padding: 4px 12px;
        font-weight: 800;
        border-radius: 999px;
        border: 2px solid var(--border);
      }
      .section-divider::before{
        content:"";
        position:absolute;
        inset-inline: 0;
        top: 50%;
        height: 2px;
        background: var(--border);
        z-index: 0;
      }
      .section-divider span{ position: relative; z-index: 1; }

      /* Ù†Øµ ØªØ¹Ø±ÙŠÙÙŠ Ø¨Ø³ÙŠØ· ØªØ­Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
      .section-lead{
        text-align:center;
        color: var(--muted);
        margin: 6px auto 12px;
        max-width: 820px;
        line-height: 1.8;
      }


            /* Ø£Ø®ÙÙ Ø³Ø·Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
      .mode-app #homeContent h2{ display:none; }

      /* (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù‚Ù„Ù‘Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙÙˆÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù…Ø§ ÙŠØ®ØªÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
      .mode-app #homeContent .dashboard-stats{ margin-top: 4px; }

      /* Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø´Ø§Ø±Ø© Ø¹Ù„Ù‰ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ù…Ù„Ø§ØµÙ‚ÙŠÙ† */
      .header-sub .user-title{
        display: inline-flex;
        align-items: baseline;
        gap: 10px;
        justify-content: flex-end;     /* RTL: ÙŠÙ…ÙŠÙ† */
        min-width: 0;
      }

      .header-sub .user-name{
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: clamp(1.2rem, 2.2vw, 1.5rem);
        line-height: 1.4;
        font-weight: 800;
        max-width: min(42vw, 520px);   /* Ù„Ø§ ÙŠØ²Ø§Ø­Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
      }



      /* Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ ÙŠØ«Ø¨Øª ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù„Ø« (Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø± ÙÙŠ RTL) */
      .header-sub .logout-btn{
        justify-self: start;
      }

      /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù„: Ø±ØµÙ‘ Ø¹Ù…ÙˆØ¯ÙŠ Ù…Ø¹ ØªÙˆØ³ÙŠØ· Ø§Ù„ÙƒÙ„ */
      @media (max-width:768px){
        .header-sub{
          grid-template-columns: 1fr;
          row-gap: 8px;
        }
        .header-sub .user-title{ justify-content: center; }
        .header-sub .stats-bar{ justify-content: center; }
        .header-sub .logout-btn{ justify-self: center; }
      }


    @media (max-width:768px){
      body{
        padding-bottom:260px;  /* âœ… Ø§Ù„Ø¢Ù† Ø¯Ø§Ø®Ù„ body */
      }
      
      .container{
        margin-bottom:180px;
      }
      
      .header-bar{
        grid-template-columns: 1fr;
      }
      
      .brand-inline{ order: 1; justify-self: center; }
      .user-actions{ order: 2; justify-self: center; }
      .driver-info,.request-header{grid-template-columns:1fr}
      .brand-logo-tall{height:56px}
      .brand-text .logo { font-size: clamp(1.6rem, 2.2vw, 2.1rem); }
      .stat-number { font-size: clamp(1.4rem, 2vw, 1.8rem); }
      .brand-text .tagline{display:none}
      .tabs{flex-direction:column}
    }


    .tabs .tab[data-tab="housing"]{ display:none !important; }


          /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³ÙÙ„ÙŠ */
      .stats-bottom-bar{
        position: fixed;
        left: 0;
        right: 0;
        bottom: 70px; /* ÙÙˆÙ‚ Ø§Ù„ÙÙˆØªØ± */
        z-index: 9000;
        display: flex;
        justify-content: center;
        gap: 12px;
        padding: 10px 20px;
        background: rgba(15, 23, 42, 0.75);
        backdrop-filter: blur(12px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      }

      .dark .stats-bottom-bar{
        background: rgba(17, 24, 39, 0.85);
        border-top-color: rgba(255, 255, 255, 0.05);
      }

      .stat-glass-card{
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 12px;
        padding: 8px 14px;
        transition: all 0.3s ease;
      }

      .stat-glass-card:hover{
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }

      .stat-icon{
        font-size: 1.8rem;
        line-height: 1;
      }

      .stat-content{
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .stat-glass-card .stat-number{
        font-size: 1.1rem;
        font-weight: 800;
        color: #fff;
        line-height: 1.2;
      }

      .stat-glass-card .stat-label{
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.75);
        line-height: 1;
      }

      /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ */
      @media (max-width: 768px){
        .stats-bottom-bar{
          bottom: 75px;
          flex-wrap: wrap;
          padding: 10px 8px;
          gap: 6px;
        }
        
        .stat-glass-card{
          flex: 1 1 100%;
          padding: 8px 12px;
        }
        
        .stat-icon{
          font-size: 1.6rem;
        }
        
        .stat-glass-card .stat-number{
          font-size: 1.1rem;
        }
        
        .stat-glass-card .stat-label{
          font-size: 0.8rem;
        }
      }
           

      /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
      html:not(.app-ready) .stats-bottom-bar{
        display: none !important;
      }


          /* Ø´Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø£Ù†ÙŠÙ‚Ø© */
    .status-badge{
      position: fixed;
      bottom: 20px;
      inset-inline-start: 20px;
      z-index: 1000;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 10px 16px;
      border-radius: 999px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      font-size: 0.85rem;
      font-weight: 700;
      color: #1f2937;
      transition: all 0.3s ease;
    }

    .dark .status-badge{
      background: rgba(17, 24, 39, 0.95);
      color: #e5e7eb;
    }

    .status-dot{
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: statusPulse 2s ease-in-out infinite;
    }

    @keyframes statusPulse{
      0%, 100%{ opacity: 1; transform: scale(1); }
      50%{ opacity: 0.6; transform: scale(1.2); }
    }

    .status-dot.online{
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
    }

    .status-dot.offline{
      background: #ef4444;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
    }

    .status-dot.loading{
      background: #f59e0b;
      box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
    }

    .status-badge.hidden{
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
    }

    @media (max-width: 768px){
      .status-badge{
        bottom: 150px;
        inset-inline-start: 10px;
        font-size: 0.75rem;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>

  <!-- Ø´Ø§Ø´Ø© ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© (Overlay) -->
  <section id="intro-screen" class="intro-screen">
    <div class="intro-content">
      <img src="assets/intro-hero.jpg" alt="ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©" class="intro-hero" loading="eager" decoding="async" fetchpriority="high">
      <button id="startBtn" class="intro-start">Ø§Ù†Ø·Ù„Ù‚</button>
      <div id="introLoader" class="intro-loader" aria-hidden="true">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
  </section>

  <!-- Ø¥Ø·Ø§Ø± Ø§Ù„ØµÙØ­Ø© -->
  <div class="container">
    
      <!-- Ø¶Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± Ù‡Ù†Ø§ -->
      <header class="header">
        <div class="header-bar">
          <div class="brand-inline">
            <div class="brand-stack">
              <img src="assets/logo-college.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¤Ø³Ø³Ø©" class="brand-logo-tall">
              <div class="brand-text">
                <div class="logo">Ù…Ø¨Ø§Ø¯Ø±Ø© Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</div>
              </div>
            </div>
          </div>

          <div class="user-actions">
            <button id="statsBtn" class="hidden btn btn-secondary" type="button">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
            <button class="pill-btn" id="themeToggleBtn" type="button" style="background:#111827">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</button>
          </div>
        </div>

        <div class="header-split"></div>

        <!-- Ø³Ø·Ø± Ù…ÙˆØ­Ù‘Ø¯: Ø§Ø³Ù… + Ø´Ø§Ø±Ø© | Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª | ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ -->
        <div class="header-sub"> 
          <div class="user-title" id="topUserInfo" style="display:none">
            <span class="user-name" id="userName" aria-live="polite">...</span>
            <span class="role-badge" id="userRole">Ù…ØªØ¯Ø±Ø¨</span>
          </div>
          <button class="logout-btn" id="logoutBtn" type="button">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </header>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <section class="login-section" id="loginSection">
      <div class="login-container">
        <div class="welcome-message">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</div>
          <form class="login-form active" id="loginForm" aria-hidden="false" onsubmit="return false;">

            <!-- Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª (Ø£ÙˆÙ„Ø§Ù‹) -->
            <!-- Ø¨Ø·Ø§Ù‚Ø©: Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª -->
              <div class="card" style="margin-bottom:16px">
                <span class="section-pill">Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</span>
                <p class="section-lead" style="margin-top:10px">
                  Ø³Ø§Ù†Ø¯ Ù„Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª Ù…Ø¨Ø§Ø¯Ø±Ø© ØªØ·ÙˆØ¹ÙŠØ© ØªØ±Ø¨Ø· Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
                  Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ø³Ø±Ø¹Ø© ÙˆØ£Ù…Ø§Ù† ÙˆØ¨Ø£Ù‚Ù„ Ù…Ø¬Ù‡ÙˆØ¯.
                </p>

                <div class="form-group" style="margin-top:12px">
                  <label for="loginTraineeId">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</label>
                  <input type="text" id="loginTraineeId" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 4461XXXX" required>
                  <small id="loginIdHint" class="field-hint neutral" style="display:none"></small>
                </div>

                <div class="alert alert-info">
                  <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù…Ùƒ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†.
                  Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ ÙÙ„Ù† ÙŠÙØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆÙŠÙØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©.
                </div>

                <button class="btn btn-primary" id="loginBtn" type="button">Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø³Ø§Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</button>
              </div>

              <!-- Ø¨Ø·Ø§Ù‚Ø©: Ø³Ø§Ù†Ø¯ Ù„Ù„Ø³ÙƒÙ† -->
              <div class="card">
                <span class="section-pill">Ø³Ø§Ù†Ø¯ Ù„Ù„Ø³ÙƒÙ†</span>
                <p class="section-lead" style="margin-top:10px">
                  ÙŠÙˆÙÙ‘Ø± â€œØ³Ø§Ù†Ø¯ Ù„Ù„Ø³ÙƒÙ†â€ Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØ­Ø¯Ù‘Ø«Ø© Ø¨Ø£Ø±Ù‚Ø§Ù… Ù…Ù„Ø§Ùƒ Ø§Ù„Ø´Ù‚Ù‚ ÙˆØ§Ù„ØºØ±Ù ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©ØŒ
                  Ù„ØªØ³Ù‡ÙŠÙ„ ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ù…Ø¹ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø¨Ø¯ÙˆÙ† ÙˆØ³Ø·Ø§Ø¡. ØªØ£ÙƒÙ‘Ø¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªÙØ§Ù‚.
                </p>
                <div style="text-align:center">
                 <button class="btn btn-outline" id="openHousingBtn" type="button">ğŸ¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø³Ø§Ù†Ø¯ Ø§Ù„Ø³ÙƒÙ†</button>
                </div>
                </div>
          </form>
      </div>
    </section>

    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <nav class="tabs" id="tabsContainer" role="tablist" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„ ÙÙŠ Ø³Ø§Ù†Ø¯">
      <button class="tab active" data-tab="home" type="button">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="tab badged" data-tab="requests" id="requestsTab" type="button">ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙŠ <span class="badge" id="requestsBadge" style="display:none">0</span></button>
      <button class="tab" data-tab="drivers" type="button">ğŸš— Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</button>
      <button class="tab" data-tab="book" type="button">â• Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</button>
      <button class="tab" data-tab="rate" type="button">â­ ØªÙ‚ÙŠÙŠÙ…</button>
      <button class="tab" data-tab="register" type="button">ğŸ‘¥ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    </nav>

    <!-- ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->

    <!-- Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <section class="content active" id="homeContent">
        <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="homeUserName">...</span> ğŸ‘‹</h2>

        <div class="welcome-banner" id="welcomeBanner">
          Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¨Ø§Ø¯Ø±Ø© Ø³Ø§Ù†Ø¯ - Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ø®Ø¯Ù…ØªÙƒ ğŸŒŸ
        </div>

        <div class="section-divider"><span>Ø³Ø§Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª</span></div>
        <p class="section-lead" style="margin-bottom:12px">
          Ø³Ø§Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ØµÙ„Ø§Øª Ù…Ø¨Ø§Ø¯Ø±Ø© ØªØ·ÙˆØ¹ÙŠØ© Ù„Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©ØŒ
          ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† ÙˆØ³Ø±ÙŠØ¹ ÙˆØ¨Ø£Ù‚Ù„ Ù…Ø¬Ù‡ÙˆØ¯.
        </p>

        <div class="dashboard-stats">
          <div class="stat-card"><div class="stat-number" id="myTripsCount">-</div><div class="stat-label">Ø±Ø­Ù„Ø§ØªÙŠ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div></div>
          <div class="stat-card"><div class="stat-number" id="myRating">-</div><div class="stat-label">ØªÙ‚ÙŠÙŠÙ…ÙŠ</div></div>
          <div class="stat-card"><div class="stat-number" id="myActiveRequests">-</div><div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</div></div>
          <div class="stat-card"><div class="stat-number" id="communitySize">-</div><div class="stat-label">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</div></div>
        </div>
        <div style="text-align:center; margin-top:16px;">
        <button class="btn btn-secondary" id="refreshHomeStats" type="button">
          ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </button>
      </div>
      </section>


    <!-- Ø·Ù„Ø¨Ø§ØªÙŠ -->
    <section class="content" id="requestsContent">
      <h2 id="requestsTitle">Ø·Ù„Ø¨Ø§ØªÙŠ</h2><br>
      <button class="btn" id="refreshRequestsBtn" type="button">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <br><br>
      <div id="userRequestsList">
        <div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p></div>
      </div>
    </section>

    <!-- Ø§Ù„Ø³Ø§Ø¦Ù‚ÙˆÙ† -->
    <section class="content" id="driversContent">
      <h2>Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† <span id="availableDriversCount" style="font-size:.9rem;opacity:.85"></span></h2>

      <div class="form-group">
        <label for="searchDriver">Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</label>
        <input id="searchDriver" class="form-control" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ø£Ùˆ D001">
      </div>

      <div class="form-group">
        <label for="filterNeighborhood">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­ÙŠ</label>
        <select id="filterNeighborhood" class="form-control">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</option>
          <option value="Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ</option>
          <option value="Ø§Ù„Ø¸Ù‡Ø±Ø©">Ø§Ù„Ø¸Ù‡Ø±Ø©</option>
          <option value="Ø§Ù„Ø­Ù‚Ù„">Ø§Ù„Ø­Ù‚Ù„</option>
          <option value="Ø§Ù„Ø³ÙŠØ®Ø©">Ø§Ù„Ø³ÙŠØ®Ø©</option>
          <option value="Ø§Ù„Ø³Ø¨Ø®Ø©">Ø§Ù„Ø³Ø¨Ø®Ø©</option>
        </select>
      </div>

      <button class="btn" id="refreshDriversBtn" type="button">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</button>
      <br><br>
      <div id="driversList">
        <div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p></div>
      </div>
    </section>

    <!-- Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ -->
    <section class="content" id="bookContent">
      <h2>Ø­Ø¬Ø² ØªÙˆØµÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2><br>
      <div class="alert alert-info"><strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª:</strong> Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŒ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨.</div>

      <form id="bookingForm">
        <div class="form-group">
          <label for="selectedDriver">Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø®ØªØ§Ø±</label>
          <select id="selectedDriver" class="form-control" required><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚</option></select>
        </div>

        <div class="form-group">
          <label>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
          <div class="checkbox-group" id="daysGroup"></div>
        </div>

        <div class="form-group">
          <label for="duration">Ù…Ø¯Ø© Ø§Ù„Ø­Ø¬Ø² (Ø¨Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)</label>
          <select id="duration" class="form-control" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø©</option>
            <option value="1">Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ø­Ø¯</option>
            <option value="2">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
            <option value="3">3 Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
            <option value="4">Ø´Ù‡Ø± ÙƒØ§Ù…Ù„</option>
          </select>
        </div>

        <div class="form-group">
          <label for="tripNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="tripNotes" class="form-control" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­ØªØ§Ø¬ Ø§Ù„ØªÙˆØµÙŠÙ„ ØµØ¨Ø§Ø­Ø§Ù‹ 7:30"></textarea>
        </div>

        <button type="submit" class="btn" id="bookingBtn">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
      </form>
    </section>

    <!-- Ø§Ù„ØªÙ‚ÙŠÙŠÙ… -->
    <section class="content" id="rateContent">
      <h2 id="rateTitle">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø§Ø¦Ù‚</h2><br>
      <form id="ratingForm">
        <div class="form-group">
          <label for="ratedDriver" id="rateSelectLabel">Ø§Ù„Ø³Ø§Ø¦Ù‚</label>
          <select id="ratedDriver" class="form-control" required><option value="">Ø§Ø®ØªØ±</option></select>
        </div>

        <div class="form-group">
          <label for="ratingStars">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
          <select id="ratingStars" class="form-control" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
            <option value="5">â­â­â­â­â­ Ù…Ù…ØªØ§Ø²</option>
            <option value="4">â­â­â­â­ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
            <option value="3">â­â­â­ Ø¬ÙŠØ¯</option>
            <option value="2">â­â­ Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option value="1">â­ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</option>
          </select>
        </div>

        <div class="form-group">
          <label for="ratingNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
          <textarea id="ratingNotes" class="form-control" rows="4" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>
        </div>

        <button type="submit" class="btn" id="ratingBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
      </form>
    </section>

    <!-- Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <section class="content" id="registerContent">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2><br>
      <div class="alert alert-info"><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø£Ù†ÙØ³Ù‡Ù… ÙƒØ³Ø§Ø¦Ù‚ÙŠÙ† Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ø£Ùˆ ÙƒÙ…Ø­ØªØ§Ø¬ÙŠÙ† Ù„Ù„ØªÙˆØµÙŠÙ„.</div>

      <div id="backToLoginWrap" class="back-to-selection" style="display:none;margin-bottom:10px">
        <button type="button" class="btn btn-secondary" id="backToLoginBtn">â¬…ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>

      <form id="registrationForm">
        <div class="form-group"><label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input type="text" id="name" class="form-control" required></div>
        <div class="form-group"><label for="traineeId">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</label><input type="text" id="traineeId" class="form-control" required></div>
        <small id="regIdHint" class="field-hint neutral"></small>
        <div class="form-group"><label for="phone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø©)</label><input type="tel" id="phone" class="form-control" placeholder="9665XXXXXXXX" required></div>

        <div class="form-group">
          <label for="neighborhood">Ø§Ù„Ø­ÙŠ</label>
          <select id="neighborhood" class="form-control" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­ÙŠ</option>
            <option value="Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ">Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ</option>
            <option value="Ø§Ù„Ø¸Ù‡Ø±Ø©">Ø§Ù„Ø¸Ù‡Ø±Ø©</option>
            <option value="Ø§Ù„Ø­Ù‚Ù„">Ø§Ù„Ø­Ù‚Ù„</option>
            <option value="Ø§Ù„Ø³ÙŠØ®Ø©">Ø§Ù„Ø³ÙŠØ®Ø©</option>
            <option value="Ø§Ù„Ø³Ø¨Ø®Ø©">Ø§Ù„Ø³Ø¨Ø®Ø©</option>
          </select>
        </div>

        <div class="form-group">
          <label for="userType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <select id="userType" class="form-control" required>
            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option>
            <option value="Ø³Ø§Ø¦Ù‚">Ø³Ø§Ø¦Ù‚ Ù…ØªØ·ÙˆØ¹</option>
            <option value="Ù…ØªØ¯Ø±Ø¨">Ù…Ø­ØªØ§Ø¬ Ù„ØªÙˆØµÙŠÙ„</option>
          </select>
        </div>

        <button type="submit" class="btn" id="registerBtn">ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø³Ø§Ù†Ø¯</button>
      </form>
    </section>
  </div><!-- /container -->



    <!-- Ø´Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
    <div class="status-badge" id="statusBadge">
      <span class="status-dot" id="statusDot"></span>
      <span class="status-text" id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>

  <!-- Ø²Ø± Ø¯Ø¹Ù… Ø¹Ø§Ø¦Ù… + ØªÙˆØ³Øª -->
  <div class="support-fab" id="supportFab" aria-label="Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ">
      <!-- ØªÙ„Ù…ÙŠØ­ ØªØ±Ø­ÙŠØ¨ÙŠ Ø¬Ø¯ÙŠØ¯ -->
      <div class="welcome-support-tooltip" id="welcomeSupportTip">
        <div class="tooltip-arrow"></div>
        <div class="tooltip-content">
          <div class="tooltip-icon">ğŸ’¬</div>
          <div class="tooltip-text">
            <strong>Ù…Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ</strong>
            <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©</span>
          </div>
        </div>
      </div>
    <div class="support-menu" aria-hidden="true">
      <a class="wa" target="_blank" rel="noopener" href="https://wa.me/9665XXXXXXXX?text=%D9%85%D8%B3%D8%A7%D8%B9%D8%AF%D8%A9%20%D8%AF%D8%B9%D9%85%20%D9%81%D9%86%D9%8A">
        <span class="ico">ğŸ’¬</span><span>ÙˆØ§ØªØ³Ø§Ø¨</span>
      </a>
      <a class="mail" href="mailto:someone@example.com?subject=%D8%AF%D8%B9%D9%85%20%D9%81%D9%86%D9%8A">
        <span class="ico">âœ‰ï¸</span><span>Ø§Ù„Ø¨Ø±ÙŠØ¯</span>
      </a>
    </div>
    <button class="main" type="button" title="Ø§Ù„Ø¯Ø¹Ù…">ğŸ›Ÿ</button>
  </div>

  <div id="toastWrap" role="region" aria-live="polite" aria-atomic="true" style="position:fixed;inset-inline-start:20px;bottom:90px;z-index:10050;display:flex;flex-direction:column;gap:10px"></div>

      <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø«Ø§Ø¨Øª -->
    <div class="stats-bottom-bar" id="statsBottomBar" aria-live="polite">
      <div class="stat-glass-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <div class="stat-number" id="totalUsersBottom">-</div>
          <div class="stat-label">Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø·</div>
        </div>
      </div>
      
      <div class="stat-glass-card">
        <div class="stat-icon">ğŸš—</div>
        <div class="stat-content">
          <div class="stat-number" id="totalTripsBottom">-</div>
          <div class="stat-label">Ø±Ø­Ù„Ø© Ù…ÙƒØªÙ…Ù„Ø©</div>
        </div>
      </div>
      
      <div class="stat-glass-card">
        <div class="stat-icon">â­</div>
        <div class="stat-content">
          <div class="stat-number" id="satisfactionBottom">-</div>
          <div class="stat-label">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©</div>
        </div>
      </div>
    </div>

    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-logo">
          <span class="footer-icon">ğŸ›ï¸</span>
          <div class="footer-text">
            <strong>Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ù†</strong>
            <span>ÙˆØ­Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© ÙˆØªØ·ÙˆÙŠØ± ÙˆÙƒØ§Ù„Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¬ÙˆØ¯Ø©</span>
          </div>
        </div>
        <div class="footer-institute">
          <span class="institute-badge">Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¨Ø­Ù‚Ù„</span>
          <span class="version">Ø§Ù„Ù†Ø³Ø®Ø© 1.0</span>
        </div>
      </div>
    </footer>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script>
    
    // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© (Ù…Ù† config.json) =====
    let GOOGLE_SCRIPT_URL = ''; // Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ù…Ù† config.json
    let API_KEY = '';
    let CFG = null;

    // Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
    let requestsAutoTimer = null;
    let allowSelfRegister = false;
    let lastVerifiedTrainee = null;
    let lastQuickDriverId = null;

    let DAYS = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³']; // Ø§ÙØªØ±Ø§Ø¶ÙŠ

    let drivers = [];
    let currentUser = null;
    let approvedPartners = [];

    // Ø§Ù„Ù‚ÙŠÙ…: 'login' | 'register_only' | 'app'
    let appMode = 'login';
    function isValidUserType(t){ return t === 'Ø³Ø§Ø¦Ù‚' || t === 'Ù…ØªØ¯Ø±Ø¨'; }

    function setAppMode(mode){
      appMode = mode;

      // Ø¶ÙŠÙ/Ø§Ø­Ø°Ù ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ <body> Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ CSS
      document.body.classList.remove('mode-login','mode-register','mode-app');
      if(mode === 'login')         document.body.classList.add('mode-login');
      if(mode === 'register_only') document.body.classList.add('mode-register');
      if(mode === 'app')           document.body.classList.add('mode-app');

      const logoutBtn    = document.getElementById('logoutBtn');
      const tabs         = document.getElementById('tabsContainer');
      const topUserInfo  = document.getElementById('topUserInfo');
      const loginSection = document.getElementById('loginSection');
      const allContents  = Array.from(document.querySelectorAll('.content'));
      const reg          = document.getElementById('registerContent');
      const backWrap     = document.getElementById('backToLoginWrap');
      const regTab       = document.querySelector('.tab[data-tab="register"]');
      if(regTab) regTab.style.display = 'none';

      const hideAllContents = ()=>{
        allContents.forEach(c=>{
          c.classList.remove('active');
          c.setAttribute('hidden','');
          c.setAttribute('aria-hidden','true');
          c.setAttribute('inert','');
        });
      };
      const showOnly = (el)=>{
        el.classList.add('active');
        el.removeAttribute('hidden');
        el.setAttribute('aria-hidden','false');
        el.removeAttribute('inert');
      };

      if(mode==='login'){
        if (logoutBtn) logoutBtn.style.display = 'none';
        loginSection.style.display='block';
        tabs.classList.remove('active');
        topUserInfo.style.display='none';
        hideAllContents();
        document.querySelector('.tab[data-tab="register"]')?.style.setProperty('display','none');
        backWrap.style.display='none';
      }

      if(mode==='register_only'){
        if (logoutBtn) logoutBtn.style.display = 'none';
        loginSection.style.display='none';
        tabs.classList.remove('active');
        topUserInfo.style.display='none';
        hideAllContents(); 
        showOnly(reg);
        document.querySelector('.tab[data-tab="register"]')?.style.setProperty('display','none');
        backWrap.style.display='block';
      }

      if(mode==='app'){
        if (logoutBtn) logoutBtn.style.display = 'inline-block'; // Ø£Ùˆ 'flex'
        loginSection.style.display='none';
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
        setTimeout(() => {
          const banner = document.getElementById('welcomeBanner');
          if(banner) banner.style.display = 'none';
        }, 5000);
        tabs.classList.add('active');
        hideAllContents(); 
        showOnly(document.getElementById('homeContent'));
        setIsHome(true); // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø© Ø§Ù„Ø¢Ù†
        topUserInfo.style.display='inline-flex'; // Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø´Ø§Ø±Ø© Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶
        allContents.forEach(c=>{
          c.removeAttribute('hidden'); 
          c.removeAttribute('inert');
          c.setAttribute('aria-hidden', c.classList.contains('active') ? 'false' : 'true');
        });
        document.querySelector('.tab[data-tab="register"]')?.style.setProperty('display','none');
        backWrap.style.display='none';
      }
    }

    function guardNavigation(ev){
      if(appMode!=='app'){
        ev.preventDefault();
        showToast('Ø£ÙƒÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.','warn');
        return true;
      }
      return false;
    }

    // ===== Utils =====
    function sanitizeStr(s){ return String(s||'').replace(/[\u200E\u200F\u202A-\u202E]/g,'').trim(); }
    function normalizeDigits(s=''){
      const map={'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9','Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9'};
      return String(s).replace(/[Ù -Ù©Û°-Û¹]/g, ch => map[ch] || ch);
    }
    function normalizePhoneKSA(raw=''){
      const s = normalizeDigits(String(raw)).replace(/\s+/g,'').replace(/[^\d+]/g,'');
      if(!s) return '';
      if(/^(\+)?9665\d{8}$/.test(s)) return s.replace(/^\+/, '');
      if(/^05\d{8}$/.test(s))        return '966' + s.slice(1);
      if(/^5\d{8}$/.test(s))         return '966' + s;
      if(/^009665\d{8}$/.test(s))    return s.replace(/^00/, '');
      return '';
    }
    function isValidPhoneKSA(v){ return /^9665\d{8}$/.test(normalizePhoneKSA(v)); }
    function buildWaUrl(phone, text=''){
      const p = normalizePhoneKSA(phone);
      if(!p) return '';
      const q = text ? ('?text=' + encodeURIComponent(text)) : '';
      return `https://wa.me/${p}${q}`;
    }
    function getWaPhoneFromRecord(rec={}){
      const candidates = [rec.phone,rec.whatsapp,rec.mobile,rec.passengerPhone,rec.driverPhone].filter(Boolean);
      for(const c of candidates){
        const n = normalizePhoneKSA(c);
        if(n) return n;
      }
      return '';
    }
    function showToast(msg,type='info',timeout=3500){
      const wrap = document.getElementById('toastWrap'); if(!wrap) return;
      const d = document.createElement('div');
      const palette = {
        info:{bg:'#cce7ff',bd:'#99d6ff',tx:'#0c5460'},
        success:{bg:'#d4edda',bd:'#c3e6cb',tx:'#155724'},
        warn:{bg:'#fff3cd',bd:'#ffeaa7',tx:'#856404'},
        error:{bg:'#f8d7da',bd:'#f5c2c7',tx:'#721c24'}
      }[type] || {bg:'#cce7ff',bd:'#99d6ff',tx:'#0c5460'};
      d.style.cssText = `padding:12px 14px;border-radius:10px;border:1px solid ${palette.bd};background:${palette.bg};color:${palette.tx};min-width:220px;box-shadow:0 10px 20px rgba(0,0,0,.08);font-weight:700`;
      d.textContent = msg;
      wrap.appendChild(d);
      setTimeout(()=>{ d.style.opacity='0'; d.style.transform='translateY(6px)'; }, timeout);
      setTimeout(()=>{ d.remove(); }, timeout+300);
    }

    // ===== Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ =====
    const connDot = () => document.getElementById('connDot');
    const connText = () => document.getElementById('connText');
    function setConnStatus(state){
      const badge = document.getElementById('statusBadge');
      const dot = document.getElementById('statusDot');
      const txt = document.getElementById('statusText');
      
      if(!badge || !dot || !txt) return;
      
      dot.classList.remove('online','offline','loading');
      
      if(state === 'online'){
        dot.classList.add('online');
        txt.textContent = 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²';
        setTimeout(() => badge.classList.add('hidden'), 2000);
      } else if(state === 'offline'){
        dot.classList.add('offline');
        txt.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
        badge.classList.remove('hidden');
      } else {
        dot.classList.add('loading');
        txt.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        badge.classList.remove('hidden');
      }
    }

    // ===== ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª =====
    const CACHE_TTL = { getTopStats:60000, getDrivers:60000, getUserStats:45000, getPassengerRequests:30000, getDriverRequests:30000 };
    const memCache = new Map();      // actionKey -> {ts,data}
    const inflight = new Map();      // actionKey -> Promise

    function stableStringify(obj){
      if (obj === null || typeof obj !== 'object') return String(obj);
      if (Array.isArray(obj)) return '[' + obj.map(stableStringify).join(',') + ']';
      const keys = Object.keys(obj).sort();
      return '{' + keys.map(k => JSON.stringify(k) + ':' + stableStringify(obj[k])).join(',') + '}';
    }
    function buildCacheKey(action,data){ return String(action||'') + ':' + stableStringify(data||{}); }
    function lcGet(key){ try{ return JSON.parse(localStorage.getItem(key) || 'null'); }catch{return null} }
    function lcSet(key,val){ try{ localStorage.setItem(key, JSON.stringify(val)); }catch{} }
    function isFresh(ts,ttl){ return (Date.now()-ts) < ttl; }

    async function fetchWithCache(action, data={}, {ttl=30000, staleOK=true} = {}){
      const cacheKey = buildCacheKey(action,data);
      const lsKey = 'sand_cache_' + cacheKey;

      const m = memCache.get(cacheKey);
      if(m && isFresh(m.ts, ttl)) return {from:'mem', data:m.data};

      const lc = lcGet(lsKey);
      if(lc && staleOK){
        backgroundRefresh(action,data,ttl);
        return {from:'local', data:lc.data, stale:!isFresh(lc.ts,ttl)};
      }

      if(inflight.has(cacheKey)) return inflight.get(cacheKey);

      const p = (async ()=>{
        const res = await sendToGoogleSheets(action,data);
        const payload = res?.data ?? null;
        const entry = {ts:Date.now(), data:payload};
        memCache.set(cacheKey, entry);
        lcSet(lsKey, entry);
        return {from:'net', data:payload};
      })().finally(()=> inflight.delete(cacheKey));

      inflight.set(cacheKey,p);
      return p;
    }

    function backgroundRefresh(action,data,ttl){
      fetchWithCache(action,data,{ttl,staleOK:false}).catch(()=>{});
    }

    async function sendToGoogleSheets(action,data){
      let connectingTimer = setTimeout(()=> setConnStatus('connecting'), 600);
      const controller = new AbortController();
      const t = setTimeout(()=> controller.abort(), 20000);

      try{
        if(!GOOGLE_SCRIPT_URL){ clearTimeout(connectingTimer); setConnStatus('offline'); throw new Error('GOOGLE_SCRIPT_URL is empty'); }

        const resp = await fetch(GOOGLE_SCRIPT_URL,{
          method:'POST',
          headers:{'Content-Type':'text/plain;charset=utf-8'},
          body:JSON.stringify({action,data, ...(API_KEY? {key:API_KEY}:{}) }),
          signal:controller.signal,
          mode:'cors',credentials:'omit',cache:'no-store',redirect:'follow',referrerPolicy:'no-referrer'
        });

        clearTimeout(connectingTimer); clearTimeout(t);
        if(!resp.ok){ setConnStatus('offline'); throw new Error('HTTP ' + resp.status); }
        const json = await resp.json().catch(()=>{ throw new Error('INVALID_JSON'); });

        setConnStatus('online');
        return json;
      }catch(err){
        clearTimeout(connectingTimer); clearTimeout(t);
        setConnStatus('offline');
        console.error('[GS Error]', err);
        throw new Error( err.name==='AbortError' ? 'TIMEOUT_20S' : (err.message==='INVALID_JSON' ? 'INVALID_JSON' : ('NET_'+(err.message||'ERR'))) );
      }
    }

    async function heartbeat(){
      try{
        const r = await fetchWithCache('getTopStats', {}, {ttl:CACHE_TTL.getTopStats});
        updateTopStats(r?.data);
      }catch{}
    }

    // ===== Ø¹Ù†Ø§ØµØ± Ù…Ø³Ø§Ø¹Ø¯Ø© Ø³Ø±ÙŠØ¹Ø© =====
    function $(sel){ return document.querySelector(sel); }
    function $$(sel){ return Array.from(document.querySelectorAll(sel)); }

    // ===== ØªÙ„Ù…ÙŠØ­Ø§Øª Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨ =====
    function hintTraineeIdState(value){
      const v = String(value||'').trim();
      if(!v){ return {cls:'neutral', msg:''}; }
      if(/^\d{6,}$/.test(v)){ return {cls:'good', msg:'âœ… Ø§Ù„ØµÙŠØºØ© Ø±Ù‚Ù…ÙŠØ© ØªØ¨Ø¯Ùˆ ØµØ­ÙŠØ­Ø©'}; }
      return {cls:'warn', msg:'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·'};
    }
    function setupTraineeIdHints(){
      const loginInput = document.getElementById('loginTraineeId');
      const loginHint  = document.getElementById('loginIdHint');
      const regInput   = document.getElementById('traineeId');
      const regHint    = document.getElementById('regIdHint');

      function bindHint(input, hintEl){
        if(!input || !hintEl) return;
        input.addEventListener('input', ()=>{
          const {cls, msg} = hintTraineeIdState(input.value);
          hintEl.classList.remove('neutral','good','warn');
          hintEl.classList.add(cls);
          hintEl.textContent = msg;
          hintEl.style.display = msg ? 'inline' : 'none';
        });
      }
      bindHint(loginInput, loginHint);
      bindHint(regInput, regHint);
    }

    // ===== ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† =====
      function updateTopStats(data){
        try{
          const u = document.getElementById('totalUsersBottom');
          const t = document.getElementById('totalTripsBottom');
          const s = document.getElementById('satisfactionBottom');

          if(u) u.textContent = data?.totalUsers ?? '-';
          if(t) t.textContent = data?.totalTrips ?? '-';

          if(s){
            const v = data?.satisfaction;
            if (v == null || v === '-') { s.textContent = '-'; }
            else if (typeof v === 'string' && v.trim().endsWith('%')) { s.textContent = v; }
            else if (!isNaN(Number(v))) { s.textContent = `${Number(v)}`.replace(/\.0+$/,'') + '%'; }
            else { s.textContent = String(v); }
          }
        }catch{}
      }
      function setIsHome(active){
        document.body.classList.toggle('is-home', !!active);
      }


    // ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ØªØ¨ÙˆÙŠØ¨Ø§Øª =====
    function switchTab(name){
      // Ù…Ù†Ø¹ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù† Ù„Ù… ÙŠÙƒÙ…Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      if(guardNavigation(new Event('nav'))) return;

      $$('.tab').forEach(b=> b.classList.toggle('active', b.dataset.tab===name));
      $$('.content').forEach(sec=>{
        const active = (sec.id === (name+'Content'));
        sec.classList.toggle('active', active);
        sec.setAttribute('aria-hidden', active ? 'false' : 'true');
      });
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ù…Ø¹ÙŠÙ‘Ù†
      if(name==='drivers')   loadDrivers();
      if(name==='requests')  loadRequests();
      if(name==='home')      loadMyStats();
      if(name==='book')      prepareBookingUI();
      if(name==='rate')      prepareRatingUI();
      setIsHome(name === 'home');
    }

    // ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† config.json =====
    async function loadConfig(){
      const url = 'config.json?ts=' + Date.now(); // ØªÙØ§Ø¯ÙŠ Ø§Ù„ÙƒØ§Ø´
      try{
        const res = await fetch(url, { cache:'no-store' });
        if(!res.ok) throw new Error('config.json not found ('+res.status+')');

        // Ù„Ùˆ Ø±Ø¬Ø¹ HTML Ø¨Ø¯Ù„ JSON (Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø³ØªØ¶Ø§ÙØ§Øª ØªØ¹ÙŠØ¯ index.html)
        const ct = (res.headers.get('content-type') || '').toLowerCase();
        const raw = await res.text();
        if (ct.includes('text/html') || raw.trim().startsWith('<')) {
          console.error('[CONFIG] Expected JSON but got HTML. First 200 chars:\n', raw.slice(0,200));
          throw new Error('config.json returned HTML');
        }

        // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ù†Øµ ÙƒÙ€ JSON Ø¨Ø¹Ø¯ Ø§Ù„ÙØ­Øµ
        const cfg = JSON.parse(raw);
        CFG = cfg;

        // Ù†Ø¯Ø¹Ù… Ø£Ø³Ù…Ø§Ø¡ Ù…ÙØ§ØªÙŠØ­ Ù…ØªØ¹Ø¯Ø¯Ø© (Ù…Ø±ÙˆÙ†Ø© Ù„Ù…Ù„ÙØ§Øª Ù‚Ø¯ÙŠÙ…Ø©/Ø¬Ø¯ÙŠØ¯Ø©)
        GOOGLE_SCRIPT_URL = sanitizeStr(
          cfg?.GOOGLE_SCRIPT_URL || cfg?.SCRIPT_URL || cfg?.scriptUrl || ''
        );
        API_KEY = sanitizeStr(
          cfg?.API_KEY || cfg?.apiKey || cfg?.defaultApiKey || ''
        );
        allowSelfRegister = !!cfg?.allowSelfRegister;

        // Ø§Ù„Ø£ÙŠØ§Ù…: Ø¥Ø°Ø§ Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ØŒ ÙˆØ¥Ù„Ø§ Ø¥Ø°Ø§ includeWeekend=true Ù†Ø¶Ù… Ø§Ù„Ø¬Ù…Ø¹Ø©+Ø§Ù„Ø³Ø¨Øª
        if (Array.isArray(cfg?.days) && cfg.days.length) {
          DAYS = cfg.days.map(String);
        } else if (cfg?.includeWeekend === true) {
          DAYS = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
        }
      }catch(e){
        console.warn('[CONFIG] Using defaults:', e.message);
        // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŒ ÙˆØªØ±Ùƒ GOOGLE_SCRIPT_URL ÙØ§Ø±ØºÙ‹Ø§ Ù„ÙŠØ¸Ù‡Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© "ØºÙŠØ± Ù…ØªØµÙ„"
      }
    }


    // ===== Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© =====
    function fillDaysCheckboxes(){
      const host = document.getElementById('daysGroup');
      if(!host) return;
      host.innerHTML = '';
      DAYS.forEach((d, i)=>{
        const id = 'day_'+i;
        const w = document.createElement('label');
        w.className = 'checkbox-item';
        w.innerHTML = `<input type="checkbox" value="${d}" id="${id}"><span>${d}</span>`;
        host.appendChild(w);
      });
    }

    function setUserHeaderUI(user){
      const name = document.getElementById('userName');
      const role = document.getElementById('userRole');
      const homeU = document.getElementById('homeUserName');
      if(name)  name.textContent  = sanitizeStr(user?.name || 'Ù…Ø³ØªØ®Ø¯Ù…');
      if(homeU) homeU.textContent = sanitizeStr(user?.name || 'Ù…Ø³ØªØ®Ø¯Ù…');
      if(role)  role.textContent  = sanitizeStr(user?.userType || 'Ø±Ø§ÙƒØ¨');
    }

    // ===== Ø§Ù„Ø³Ø§Ø¦Ù‚ÙˆÙ† =====
    function renderDrivers(list){
      const wrap = document.getElementById('driversList');
      const countEl = document.getElementById('availableDriversCount');
      if(countEl) countEl.textContent = `(${list?.length ?? 0})`;
      if(!wrap) return;

      if(!list || !list.length){
        wrap.innerHTML = `<div class="alert alert-warning">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¦Ù‚ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
        return;
      }

      wrap.innerHTML = '';
      list.forEach(d=>{
        const phone = getWaPhoneFromRecord(d);
        const waUrl = phone ? buildWaUrl(phone, `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${d.name}ØŒ Ø£ÙˆØ¯ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„Ø±Ø­Ù„Ø© Ø¹Ø¨Ø± "Ø³Ø§Ù†Ø¯".`) : '';
        const card = document.createElement('div');
        card.className = 'driver-card';
        card.innerHTML = `
          <div class="driver-info">
            <div class="driver-details">
              <h3>${sanitizeStr(d.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…')}</h3>
              <p>Ø§Ù„Ø±Ù‚Ù…: <strong>${sanitizeStr(d.traineeId || d.id || '')}</strong></p>
              <p>Ø§Ù„Ø­ÙŠ: ${sanitizeStr(d.neighborhood || '-')}</p>
              <p class="rating">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${'â­'.repeat(Math.max(1, Math.min(5, Number(d.rating)||0)))} (${d.rating||0})</p>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              ${waUrl ? `<a class="btn btn-whatsapp" href="${waUrl}" target="_blank" rel="noopener">ÙˆØ§ØªØ³Ø§Ø¨</a>`:''}
              <button class="btn btn-primary" data-pick="${sanitizeStr(d.traineeId || d.id || '')}">Ø§Ø®ØªÙŠØ§Ø±</button>
            </div>
          </div>
        `;
        wrap.appendChild(card);
      });

      // Ø§Ø®ØªÙŠØ§Ø± Ø³Ø±ÙŠØ¹ Ù„Ø³Ø§Ø¦Ù‚
      wrap.querySelectorAll('button[data-pick]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-pick');
          lastQuickDriverId = id;
          document.querySelector('.tab[data-tab="book"]')?.click();
          setTimeout(()=>{
            const sel = document.getElementById('selectedDriver');
            if(sel){
              const match = drivers.find(x => (x.traineeId||x.id) == id);
              if(match){
                sel.value = (match.traineeId || match.id || '');
              }
            }
          }, 50);
        });
      });
    }

    async function loadDrivers(){
      try{
        const q = $('#searchDriver')?.value?.trim() || '';
        const neigh = $('#filterNeighborhood')?.value || '';
        const {data} = await fetchWithCache('getDrivers', {}, {ttl:CACHE_TTL.getDrivers});
        let list = Array.isArray(data) ? data : [];

        // ÙÙ„ØªØ±Ø©
        if(q){
          const nq = normalizeDigits(q).toLowerCase();
          list = list.filter(d =>
            String(d.name||'').toLowerCase().includes(nq) ||
            String(d.traineeId||d.id||'').toLowerCase().includes(nq)
          );
        }
        if(neigh) list = list.filter(d => String(d.neighborhood||'') === neigh);

        drivers = list;
        renderDrivers(list);
      }catch(e){
        $('#driversList').innerHTML = `<div class="alert alert-error">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</div>`;
      }
    }

    // ===== Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
    function renderRequests(list){
      const host = document.getElementById('userRequestsList');
      const badge = document.getElementById('requestsBadge');
      if(!host) return;

      if(!list || !list.length){
        host.innerHTML = `<div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
        if(badge){ badge.textContent='0'; badge.style.display='none'; }
        return;
      }

      host.innerHTML = '';
      let activeCount = 0;

      list.forEach(r=>{
        const st = String(r.status||'pending');
        if(st==='pending') activeCount++;
        const cls = st==='accepted' ? 'accepted' : (st==='rejected' ? 'rejected' : '');
        const d = document.createElement('div');
        d.className = `request-card ${cls}`;
        d.innerHTML = `
          <div class="request-header">
            <div class="request-title">Ø·Ù„Ø¨ #${sanitizeStr(r.id||'-')}</div>
            <div class="status-${st==='accepted'?'accepted':(st==='rejected'?'rejected':'pending')}">
              ${st==='accepted'?'Ù…Ù‚Ø¨ÙˆÙ„':(st==='rejected'?'Ù…Ø±ÙÙˆØ¶':'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')}
            </div>
          </div>
          <div class="request-details">
            <p>Ø§Ù„Ø³Ø§Ø¦Ù‚: <strong>${sanitizeStr(r.driverName || '-')}</strong></p>
            <p>Ø§Ù„Ø£ÙŠØ§Ù…: ${Array.isArray(r.days)? r.days.join('ØŒ ') : '-'}</p>
            <p>Ø§Ù„Ù…Ø¯Ø©: ${sanitizeStr(r.duration || '-')} Ø£Ø³Ø¨ÙˆØ¹</p>
            ${r.notes? `<p>Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${sanitizeStr(r.notes)}</p>`:''}
          </div>
        `;
        host.appendChild(d);
      });

      if(badge){
        badge.textContent = String(activeCount);
        badge.style.display = activeCount ? 'inline-flex' : 'none';
      }
    }

    async function loadRequests(){
      if(!currentUser) return;
      try{
        const {data} = await fetchWithCache('getPassengerRequests', { passengerTraineeId: currentUser.traineeId }, { ttl: CACHE_TTL.getPassengerRequests });
        renderRequests(Array.isArray(data)?data:[]);
      }catch{
        $('#userRequestsList').innerHTML = `<div class="alert alert-error">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>`;
      }
    }


    function pickNumber(obj, keys){
        for(const k of keys){
          const v = Number(obj?.[k]);
          if(!Number.isNaN(v) && v >= 0) return v;
        }
        return null;
      }

    // ===== Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ =====
      function updateMyStatsUI(data){
        $('#myTripsCount').textContent     = (data?.totalTrips ?? '-');
        $('#myRating').textContent         = data?.rating ? `${data.rating} â­` : '-';
        $('#myActiveRequests').textContent = data?.activeRequests ?? '-';
        $('#communitySize').textContent    = (data?.community ?? '-');
      }


    async function loadMyStats(){
      if(!currentUser) return;
      try{
          const [{data:me},{data:top}] = await Promise.all([
            fetchWithCache('getUserStats', {
              traineeId: currentUser.traineeId,
              userType: currentUser.userType   // âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ù‡Ù…
            }, {ttl: CACHE_TTL.getUserStats}),
            fetchWithCache('getTopStats', {}, {ttl: CACHE_TTL.getTopStats})
          ]);


        // Ø¬Ù‡Ù‘Ø² â€œcommunityâ€ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø§ Ø±Ø¬Ù‘Ø¹Ù‡
        const communityFallback = pickNumber(me, ['community','communitySize','members','users','community_count'])
                              ?? pickNumber(top, ['totalUsers','users']);
        const merged = {...(me||{}), community: communityFallback};

        updateMyStatsUI(merged||{});
      }catch(e){
        // Ù…Ù…ÙƒÙ† ØªØ®Ù„ÙŠÙ‡Ø§ ØµØ§Ù…ØªØ© Ø£Ùˆ ØªØ¶ÙŠÙ Ù„ÙˆØ¬:
        console.debug('loadMyStats error', e);
      }
    }


    // ===== Ø§Ù„Ø­Ø¬Ø² =====
    function prepareBookingUI(){
      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† ÙÙŠ Ø§Ù„Ø³Ù„ÙƒØª
      const sel = document.getElementById('selectedDriver');
      if(sel){
        const cur = sel.value;
        sel.innerHTML = `<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚</option>` + drivers.map(d=>{
          const id = sanitizeStr(d.traineeId || d.id || '');
          const nm = sanitizeStr(d.name || id || 'Ø³Ø§Ø¦Ù‚');
          return `<option value="${id}">${nm} â€” ${sanitizeStr(d.neighborhood||'-')}</option>`;
        }).join('');
        if(lastQuickDriverId) sel.value = lastQuickDriverId;
        if(cur && !sel.value) sel.value = cur;
      }
      fillDaysCheckboxes();
    }

    async function submitBooking(ev){
      ev?.preventDefault?.();
      if(!currentUser){ showToast('Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','warn'); return; }

      const driverId = $('#selectedDriver').value;
      const days = Array.from(document.querySelectorAll('#daysGroup input:checked')).map(i=>i.value);
      const duration = Number($('#duration').value || 0);
      const notes = $('#tripNotes').value.trim();

      if(!driverId){ showToast('Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚','warn'); return; }
      if(!days.length){ showToast('Ø§Ø®ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯','warn'); return; }
      if(!duration){ showToast('Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø©','warn'); return; }

      const driver = drivers.find(d => (d.traineeId||d.id) == driverId);
      const wa = driver ? getWaPhoneFromRecord(driver) : '';

      try{
        $('#bookingBtn').disabled = true;
        const payload = {
          passengerId: currentUser.traineeId,
          passengerName: currentUser.name,
          driverId,
          days,
          duration,
          notes
        };
        const resp = await sendToGoogleSheets('submitBooking', payload);
        if(resp?.ok){
          showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­','success');
          // ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ø®ØªÙŠØ§Ø±ÙŠ
          if(wa){
            const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${driver?.name||''}ØŒ Ø£Ù†Ø§ ${currentUser.name}. Ø·Ù„Ø¨Øª ØªÙˆØµÙŠÙ„ (${days.join('ØŒ ')}) Ù„Ù…Ø¯Ø© ${duration} Ø£Ø³Ø¨ÙˆØ¹(Ø£Ø³Ø§Ø¨ÙŠØ¹) Ø¹Ø¨Ø± "Ø³Ø§Ù†Ø¯".`;
            window.open(buildWaUrl(wa, msg), '_blank', 'noopener');
          }
          loadRequests();
          document.querySelector('.tab[data-tab="requests"]')?.click();
        }else{
          showToast('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨','error');
        }
      }catch{
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„','error');
      }finally{
        $('#bookingBtn').disabled = false;
      }
    }

    // ===== Ø§Ù„ØªÙ‚ÙŠÙŠÙ… =====
    function prepareRatingUI(){
      const sel = document.getElementById('ratedDriver');
      if(!sel) return;
      const cur = sel.value;
      sel.innerHTML = `<option value="">Ø§Ø®ØªØ±</option>` + drivers.map(d=>{
        const id = sanitizeStr(d.traineeId || d.id || '');
        const nm = sanitizeStr(d.name || id || 'Ø³Ø§Ø¦Ù‚');
        return `<option value="${id}">${nm}</option>`;
      }).join('');
      if(cur) sel.value = cur;
    }

    async function submitRating(ev){
      ev?.preventDefault?.();
      if(!currentUser){ showToast('Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹','warn'); return; }
      const driverId = $('#ratedDriver').value;
      const stars    = Number($('#ratingStars').value || 0);
      const notes    = $('#ratingNotes').value.trim();

      if(!driverId || !stars){ showToast('Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…','warn'); return; }

      try{
        $('#ratingBtn').disabled = true;
        const payload = {
          passengerId: currentUser.traineeId,
          driverId,
          stars,
          notes
        };
        const resp = await sendToGoogleSheets('submitRating', payload);
        if(resp?.ok){
          showToast('Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ','success');
          $('#ratingForm').reset();
          loadMyStats();
        }else{
          showToast('ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…','error');
        }
      }catch{
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„','error');
      }finally{
        $('#ratingBtn').disabled = false;
      }
    }

    // ===== Ø§Ù„ØªØ³Ø¬ÙŠÙ„ =====
    async function submitRegistration(ev){
      ev?.preventDefault?.();
      const name  = $('#name').value.trim();
      const id    = normalizeDigits($('#traineeId').value.trim());
      const phone = normalizePhoneKSA($('#phone').value);
      const hood  = $('#neighborhood').value;
      const type  = $('#userType').value;

      if(!name || !id || !phone || !hood || !isValidUserType(type)){
        showToast('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­','warn'); return;
      }

      try{
        $('#registerBtn').disabled = true;
        const payload = {name, traineeId:id, phone, neighborhood:hood, userType:type};
        const resp = await sendToGoogleSheets('registerUser', payload);
        if(resp?.ok){
          showToast('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†','success');
          // Ø¹ÙˆØ¯Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
          setAppMode('login');
          $('#loginTraineeId').value = id;
        }else{
          showToast(resp?.error||'ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„','error');
        }
      }catch{
        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„','error');
      }finally{
        $('#registerBtn').disabled = false;
      }
    }

    // ===== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =====
    async function doLogin(){
      const raw = $('#loginTraineeId').value.trim();
      const id  = normalizeDigits(raw);
      if(!/^\d{6,}$/.test(id)){ showToast('Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­','warn'); return; }

      try{
        $('#loginBtn').disabled = true;
        const resp = await sendToGoogleSheets('verifyUser', { traineeId:id });
        if (resp?.success && resp?.data){
          currentUser = resp.data; // {name, traineeId, userType, ...}
          setUserHeaderUI(currentUser);
          setAppMode('app');
          document.documentElement.classList.add('app-ready'); // Ø¥ØºÙ„Ø§Ù‚ Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
          showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø³Ø§Ù†Ø¯','success');
          // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
          heartbeat();
          loadDrivers();
          loadRequests();
          loadMyStats();
        }else{
          if(allowSelfRegister){
            showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù…Ùƒ â€” Ø£ÙƒÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„','warn');
            setAppMode('register_only');
            $('#traineeId').value = id;
          }else{
            showToast('Ø±Ù‚Ù…Ùƒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ â€” ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Ø©','error');
          }
        }
      }catch{
        showToast('ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù‚Ù…','error');
      }finally{
        $('#loginBtn').disabled = false;
      }
    }

    // ===== Ø§Ù„Ø«ÙŠÙ… =====
    function toggleTheme(){
      const root = document.documentElement;
      const btn  = document.getElementById('themeToggleBtn');
      const dark = root.classList.toggle('dark');
      if(btn) btn.textContent = dark ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†';
      try{ localStorage.setItem('sand_theme', dark?'dark':'light'); }catch{}
    }
    function restoreTheme(){
      try{
        const v = localStorage.getItem('sand_theme');
        if(v==='dark'){ document.documentElement.classList.add('dark'); $('#themeToggleBtn').textContent='Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­'; }
      }catch{}
    }

    // ===== Ø¯Ø¹Ù… Ø¹Ø§Ø¦Ù… =====
    function setupSupportFab(){
      const fab = document.getElementById('supportFab');
      const welcomeTip = document.getElementById('welcomeSupportTip');
      if(!fab) return;
      
      const main = fab.querySelector('button.main');
      const menu = fab.querySelector('.support-menu');
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      const hasSeenTip = localStorage.getItem('sand_support_tip_seen');
      if(!hasSeenTip && welcomeTip){
        setTimeout(()=>{
          welcomeTip.classList.add('show');
          
          // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø¹Ø¯ 6 Ø«ÙˆØ§Ù†Ù
          setTimeout(()=>{
            welcomeTip.classList.remove('show');
            localStorage.setItem('sand_support_tip_seen', 'true');
          }, 6000);
        }, 1500); // ØªØ£Ø®ÙŠØ± Ø«Ø§Ù†ÙŠØ© ÙˆÙ†Øµ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
      }
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ã—
      if(welcomeTip){
        welcomeTip.addEventListener('click', (e)=>{
          if(e.target === welcomeTip || e.offsetX > welcomeTip.offsetWidth - 30){
            welcomeTip.classList.remove('show');
            localStorage.setItem('sand_support_tip_seen', 'true');
          }
        });
      }
      
      // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø¹Ù…
      main?.addEventListener('click', ()=>{
        fab.classList.toggle('open');
        if(welcomeTip) welcomeTip.classList.remove('show');
      });
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      document.addEventListener('click', (e)=>{
        if(!fab.contains(e.target)){
          fab.classList.remove('open');
        }
      });
    }
    // ===== Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© =====
    function setupUIEvents(){
      // ØªØ¨ÙˆÙŠØ¨Ø§Øª
      $$('.tab').forEach(b=>{
        b.addEventListener('click', ()=> switchTab(b.dataset.tab));
      });

      $('#openHousingBtn')?.addEventListener('click', ()=>{
        // Ø§ÙØªØ­ ØµÙØ­Ø© Ø¹Ø§Ù…Ø© Ù…Ø³ØªÙ‚Ù„Ø© Ù„Ø³Ø§Ù†Ø¯ Ù„Ù„Ø³ÙƒÙ†
        window.location.href = 'housing.html';
      });


      // Ø£Ø²Ø±Ø§Ø±
      $('#refreshDriversBtn')?.addEventListener('click', loadDrivers);
      $('#refreshRequestsBtn')?.addEventListener('click', loadRequests);
      $('#bookingForm')?.addEventListener('submit', submitBooking);
      $('#ratingForm')?.addEventListener('submit', submitRating);
      $('#registrationForm')?.addEventListener('submit', submitRegistration);
      $('#loginBtn')?.addEventListener('click', doLogin);
      $('#logoutBtn')?.addEventListener('click', ()=>{
        currentUser = null;
        showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬','info');
        setAppMode('login');
      });
      $('#themeToggleBtn')?.addEventListener('click', toggleTheme);

      // Ø¨Ø­Ø«/ÙÙ„ØªØ±Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
      $('#searchDriver')?.addEventListener('input', ()=> loadDrivers());
      $('#filterNeighborhood')?.addEventListener('change', ()=> loadDrivers());

      // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      $('#backToLoginBtn')?.addEventListener('click', ()=> setAppMode('login'));

      // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      $('#refreshHomeStats')?.addEventListener('click', async () => {
        const btn = $('#refreshHomeStats');
        btn.disabled = true;
        btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
        await loadMyStats();
        await heartbeat();
        btn.textContent = 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª';
        btn.disabled = false;
        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'success');
      });
      setupTraineeIdHints();
      setupSupportFab();
    }
          // ====== Ø³Ø§Ù†Ø¯ Ù„Ù„Ø³ÙƒÙ† (rent) ======
      function telHref(raw=''){
        const s = normalizePhoneKSA(raw);      // Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ
        return s ? `tel:+${s}` : '#';
      }

      // Ø´ÙƒÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ÙƒÙ„ Ù…Ø§Ù„Ùƒ
      function housingCard(row){
        const seq  = sanitizeStr(row.seq ?? row['Ø§Ù„ØªØ³Ù„Ø³Ù„'] ?? '');
        const name = sanitizeStr(row.owner ?? row['Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ'] ?? '');
        const ph   = sanitizeStr(row.phone ?? row['Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„'] ?? '');
        const gov  = sanitizeStr(row.governorate ?? row['Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©'] ?? '');
        const hood = sanitizeStr(row.neighborhood ?? row['Ø§Ù„Ø­ÙŠ'] ?? '');

        return `
          <div class="driver-card" style="margin-bottom:10px">
            <div class="driver-info">
              <div class="driver-details">
                <h3>${name || 'â€”'}</h3>
                <p>Ø§Ù„ØªØ³Ù„Ø³Ù„: <strong>${seq || '-'}</strong></p>
                <p>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${gov || '-'}</p>
                <p>Ø§Ù„Ø­ÙŠ: ${hood || '-'}</p>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                ${ph ? `<a class="btn btn-contact" href="${telHref(ph)}">ğŸ“ Ø§ØªØµØ§Ù„</a>` : '<span class="status-pending">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…</span>'}
              </div>
            </div>
          </div>
        `;
      }

      function renderHousingTabs(data){
        const tabsWrap = document.getElementById('housingTabs');
        const panels   = document.getElementById('housingPanels');
        if(!tabsWrap || !panels) return;

        // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
        const byGov = new Map();
        (Array.isArray(data) ? data : []).forEach(r=>{
          const gov = sanitizeStr(r.governorate ?? r['Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©'] ?? 'Ø£Ø®Ø±Ù‰') || 'Ø£Ø®Ø±Ù‰';
          if(!byGov.has(gov)) byGov.set(gov, []);
          byGov.get(gov).push(r);
        });

        tabsWrap.innerHTML = '';
        panels.innerHTML = '';

        const govs = Array.from(byGov.keys()).sort((a,b)=> a.localeCompare(b, 'ar'));

        govs.forEach((gov, idx)=>{
          const tid = `hgov_${idx}`;

          // Ø²Ø± ØªØ¨ÙˆÙŠØ¨ Ù„Ù„Ù…Ø­Ø§ÙØ¸Ø©
          const btn = document.createElement('button');
          btn.className = 'tab' + (idx===0 ? ' active' : '');
          btn.type = 'button';
          btn.dataset.tab = tid;
          btn.textContent = gov;
          tabsWrap.appendChild(btn);

          // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
          const panel = document.createElement('div');
          panel.className = 'content' + (idx===0 ? ' active' : '');
          panel.id = tid;
          panel.innerHTML = byGov.get(gov).map(housingCard).join('') || `
            <div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
          panels.appendChild(panel);
        });

        // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø³ÙƒÙ†
        tabsWrap.querySelectorAll('.tab').forEach(b=>{
          b.addEventListener('click', ()=>{
            tabsWrap.querySelectorAll('.tab').forEach(x=> x.classList.toggle('active', x===b));
            panels.querySelectorAll('.content').forEach(sec=>{
              const active = (sec.id === b.dataset.tab);
              sec.classList.toggle('active', active);
              sec.setAttribute('aria-hidden', active ? 'false' : 'true');
            });
          });
        });
      }

      async function loadHousing(){
        try{
          const {data} = await fetchWithCache('getRent', {}, {ttl: 60000});
          renderHousingTabs(Array.isArray(data) ? data : []);
        }catch(e){
          const panels = document.getElementById('housingPanels');
          if(panels){
            panels.innerHTML = `<div class="alert alert-error">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙƒÙ†</div>`;
          }
        }
      }


    // ===== Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© =====
    async function startApp(){
      const startBtn = document.getElementById('startBtn');
      const loader   = document.getElementById('introLoader');
      startBtn?.addEventListener('click', async ()=>{
        try{
          startBtn.disabled = true;
          loader?.classList.add('show');
          await loadConfig();
          restoreTheme();
          try{
            await heartbeat();
            setConnStatus('online');
          }catch{
            setConnStatus('offline');
          }
          // Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          document.documentElement.classList.add('app-ready');
          setAppMode('login');
          setupUIEvents();
          // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
          if(requestsAutoTimer) clearInterval(requestsAutoTimer);
          requestsAutoTimer = setInterval(heartbeat, 60000);
        }catch{
          showToast('ØªØ¹Ø°Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª','error');
        }finally{
          loader?.classList.remove('show');
          startBtn.disabled = false;
        }
      });
    }

    // ØªØ´ØºÙŠÙ„
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        // Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø¯Ø®Ù„ Ø³Ø§Ø¨Ù‚Ø§Ù‹ (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø¢Ù…Ù†)
        // Ø­Ø§Ù„ÙŠØ§Ù‹ Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
        startApp();
      }catch(e){
        console.error(e);
      }
    });
  </script>
</body>
</html>
